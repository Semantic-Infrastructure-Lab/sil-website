<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Building the semantic substrate for trustworthy AI. The Semantic Infrastructure Lab develops tools, research, and production systems for transparent AI.">
    <meta name="keywords" content="semantic infrastructure, AI transparency, reveal, beth, TIA, semantic tools, machine reasoning, provenance">
    <meta name="author" content="Semantic Infrastructure Lab">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">

    <link rel="stylesheet" href="/static/css/style.css">

    <!-- Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
        });
    </script>

    <!-- Plausible Analytics -->
    <script defer data-domain="semanticinfrastructurelab.org" src="https://analytics.semanticinfrastructurelab.org/js/script.js"></script>
</head>
<body>
    <div class="container">
        <!-- Simple top navigation -->
        <header class="site-header">
            <div class="header-content">
                <h1 class="site-title"><a href="/">Semantic Infrastructure Lab</a></h1>
                <nav class="main-nav">
                    {% for item in nav_items %}
                    <a href="{{ item.url }}" class="nav-link{% if item.url == current_page %} active{% endif %}">{{ item.label }}</a>
                    {% endfor %}
                </nav>
            </div>
        </header>

        <!-- Main content -->
        <main class="main-content">
            {{ content | safe }}
        </main>

        <!-- Footer -->
        <footer class="site-footer">
            <div class="footer-content">
                <p>&copy; 2025 Semantic Infrastructure Lab. Building the semantic substrate for trustworthy AI.</p>
                <p><a href="/tools">Tools</a> | <a href="/research">Research</a> | <a href="/contact">Contact</a></p>
            </div>
        </footer>
    </div>

    <!-- Mermaid.js for interactive diagram rendering -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

        // Configure Mermaid
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            themeVariables: {
                primaryColor: '#e1f5ff',
                primaryTextColor: '#1a1a1a',
                primaryBorderColor: '#7c96a3',
                lineColor: '#5c7080',
                secondaryColor: '#fff4e1',
                tertiaryColor: '#f0ffe1',
                fontSize: '16px',
                fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // Helper function to unescape HTML entities
        function unescapeHTML(str) {
            const doc = new DOMParser().parseFromString('<!doctype html><body>' + str, 'text/html');
            return doc.body.textContent;
        }

        // Convert markdown code blocks to Mermaid diagrams
        document.addEventListener('DOMContentLoaded', async () => {
            const mermaidBlocks = document.querySelectorAll('code.language-mermaid');

            for (const block of mermaidBlocks) {
                const code = unescapeHTML(block.textContent);
                const div = document.createElement('div');
                div.className = 'mermaid';
                div.textContent = code;
                const pre = block.parentElement;
                pre.parentElement.replaceChild(div, pre);
            }

            await mermaid.run({
                querySelector: '.mermaid'
            });
        });
    </script>
</body>
</html>
